<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.S20230403.accom">
	<select id="yssearchAc" resultType="Accom" parameterType="Accom">
			SELECT
		r_img1.BIZ_ID AS biz_id, r_img1.R_IMG AS r_img, a.addr, a.biz_name,
		a.description
		FROM ROOM_IMG r_img1
		JOIN (
		SELECT room_img1.BIZ_ID AS biz_id, room_img2.R_ID AS r_id,
		MIN(room_img1.R_IMG_ID) AS R_IMG_ID
		FROM ROOM_IMG room_img1
		JOIN (
		SELECT BIZ_ID, MIN(R_ID) AS R_ID
		FROM ROOM_IMG
		GROUP BY BIZ_ID
		) room_img2 ON room_img1.BIZ_ID = room_img2.BIZ_ID AND room_img1.R_ID =
		room_img2.R_ID
		GROUP BY room_img1.BIZ_ID, room_img2.R_ID
		) r_img2 ON r_img1.BIZ_ID = r_img2.biz_id
		AND r_img1.R_ID = r_img2.r_id
		AND r_img1.R_IMG_ID = r_img2.R_IMG_ID
		JOIN accom a ON r_img1.BIZ_ID = a.biz_id
		WHERE a.addr LIKE '%' || #{keyword} || '%' OR a.BIZ_NAME LIKE '%' ||
		#{keyword} || '%'
	</select>
	<select id="ysAccomPage" resultType="int" parameterType="Accom">
		select
		count(*)
		from accom
	</select>
	<select id="ysAccomSearch" parameterType="Accom"
		resultType="Accom">
		SELECT *
		FROM (
		SELECT rownum rn, a.*
		FROM (
		SELECT *
		FROM Accom
		<choose>
		
			<when test="search == 's_biz_id'">
				WHERE biz_id LIKE '%' || #{keyword} || '%'
			</when>
			<when test="search == 's_user_id'">
				WHERE user_id LIKE '%' || #{keyword} || '%'
			</when>
			<when test="search == 's_accom_avail'">
				WHERE ccom_avail LIKE '%' || #{keyword} || '%'
			</when>
			<when test="search == 's_biz_name'">
				WHERE biz_name LIKE '%' || #{keyword} || '%'
			</when>
			<when test="search == 's_addr'">
				WHERE addr LIKE '%' || #{keyword} || '%'
			</when>
			<otherwise>
				WHERE biz_id LIKE '%'
			</otherwise>
		</choose>
		ORDER BY biz_id
		) a ) WHERE rn BETWEEN #{start} AND #{end}
	</select>
	<select id="ysAccomSearchPage" resultType="int"
		parameterType="Accom">
		select count(*)
		from Accom
		where
		<choose>
			<when test="search == 's_biz_id'">
				biz_id like '%' || #{keyword} || '%'
			</when>
			<when test="search == 's_user_id'">
				user_id like '%' || #{keyword} || '%'
			</when>
			<when test="search == 's_accom_avail'">
				accom_avail like '%' || #{keyword} || '%'
			</when>
			<when test="search == 's_biz_name'">
				biz_name like '%' || #{keyword} || '%'
			</when>
			<when test="search == 's_addr'">
				addr like '%' || #{keyword} || '%'
			</when>
			<otherwise>
				biz_id like '%'
			</otherwise>
		</choose>
	</select>

</mapper>